
## Встановлення

Протестовано на версії 2022.3.22

Встановіть пакет через `Package Manager` за посиланням:
```
Window > Package Manager > Add package from git URL
```

```
https://github.com/kukumberman/UnityURP-MobileDrawMeshInstancedIndirectExample.git?path=/Assets/UPM
```

## Демо

Присутня демо-сцена із підготовленими об*єктами для демонстрації функціоналу. Щоб редагувати цю сцену та матеріали - потрібно скопіювати їх до себе в директорію `Assets`

Розміщення в іерархії вікна `Project`:

```
Packages/Instanced Grass Renderer/Samples/SamplesUniversalRP/S_SampleURP
```

або локально на диску за шляхом:

```
<Project>/Library/PackageCache/com.kukumberman.unity-instanced-grass-renderer/Samples/SamplesUniversalRP/S_SampleURP.unity
```

## Налаштування з нуля

- створіть пустий GameObject та додайте компонент `GrassManager`
- додайте компонент `InstancedIndirectGrassRenderer` на існуючий GameObject (або створіть пустий GameObject в ієрархії `GrassManager`)
- налаштуйте значення компонента `GrassManager`:
- - додайте власноруч усі `InstancedIndirectGrassRenderer` у список **Renderers**
- - або через контекстне меню компонента `GrassManager` натисніть **CacheRenderers** щоб заповнити список (із ієрархії цього об*єкта)
- налаштуйте значення компоненту `InstancedIndirectGrassRenderer` (див. нижче)
- додайте на сцену GameObject із компонентом `MeshGrassContainerBehaviour` або `InstancedIndirectGrassPosDefine` (та налаштуйте їх) для відображення трави

## Компоненти

#### InstancedIndirectGrassRenderer

- **Grass** - посилання на `GrassScriptableObject`, яка буде відображатись із параметрами цього компоненту (повинен бути унікальним для кожного екземпляру `InstancedIndirectGrassRenderer`)
- **Receive Shadows** - чи повинна трава отримувати тінь (перевірено тільки в URP)
- **Draw Distance** - дистанція в метрах в межах якої відображається трава (більше значення - більше навантаження)
- **Instance Material** - матеріал із підтримкою `GPU instancing` (повинен бути унікальним для кожного екземпляру `InstancedIndirectGrassRenderer`), (можна скопіювати із файлів демо-сцени)
- **Use Culling Per Grass** - активно - відсікається кожна травинка, неактивно - відсікається кожен чанк
- **Cell Size** - розмір клітинки чанку (в метрах)
- **Threshold** - поріг відсікання в екранних координатах (по замовчуванню - 1.1)
- **Culling Compute Shader** - шейдер із логікою відсікання трави, всюди однаковий (можна орієнтуватись на демо сцену)
- **Should Batch Dispatch** - чи варто групувати виклики шейдеру відсікання трави (активно - краще)
- **Debug Display Visible Count** - чи слід відображати (в інспекторі) число видимих травинок
- **Debug Visible Count** - число видимих травинок (якщо параметр активний)
- **Draw Cells Gizmo** - чи слід відображати клітинки чанку (тільки в редакторі, потрібно для візуального дебагу, як і інші параметри гізмо)
- **Draw Visible Cells** - чи слід відображати видимі клітинки (зелений колір)
- **Draw Invisible Cells** - чи слід відображати клітинки поза межами зору (червоний колір)
- **Draw Cell Label** - чи слід відображати координату клітинки

<hr>

#### InstancedIndirectGrassPosDefine

Опис: обраховує позиції трави на площині XZ, розмір задається у компонента `Transform`

Налаштування:
- **Grass** - посилання на `GrassScriptableObject`, яка буде відображатись на цій поверхні
- **Type** - 2 можливих варіанти, впливає на кількість травинок, за основу береться змінна з такою ж назвою
- - **Instance Count**
- - **Density**
- **Instance Count** - загальна кількість травинок на площині 
- **Density** - кількість травинок на квадратний метр (в середньому)
- **Seed** - унікальний код, визначає в яких позиціях буде згенерована позиція для кожної травинки (по замовчуванню - 0, слід змінювати коли на одній площині використовується декілька компонентів із однаковою кількістю трави, щоб уникнути однакових позицій)
- **Height Offset** - вертикальне зміщення кожного екземпляра трави (по замовчуванню - 0, слід змінювати коли не влаштовує півот сітки трави)

<hr>

#### MeshGrassContainerBehaviour

Опис: обраховує позиції трави на сітці 3д об*єкту, відносно свого компонента `Transform` (із урахуванням повороту та розміру)

Налаштування:
- **Grass** - посилання на `GrassScriptableObject`, яка буде відображатись на цій поверхні
- **Mesh Filter** - посилання на компонент `MeshFilter` із сіткою (зазвичай поряд із компонентом, сітка повинна мати увімкнений параметр **Read/Write**)
- **Sample Count** - загальна кількість позицій травинок (до фільтрації)
- **Seed** - унікальний код, який рандомізує позиції травинок
- **Use Filter By Normal** - вказує чи варто використовувати фільтрацію травинок по вектору нормалі
- **Normal Dot Threshold** - поріг значення скалярного добутку вектору нормалі вертекса сітки та цільового вектору нормалі (значення 0.99 - трава тільки на повернях які перпендикулярні до землі, 0.01 - трава на поверхнях верхньої площини кола) (пояснення в інтернеті по запиту **dot product visualization**)
- **Target Normal** - цільове значення вектору нормалі (по замовчуванню (0; 1; 0), оскільки трава відображається вертикально вверх)
- **Use Filter By Texture Mask** - вказує чи варто використовувати фільтрацію травинок по чорно-білій текстурі
- **Mask Texture** - 2д текстура маски, вимагає увімкнений параметр `Advanced > Read/Write`
- **Mask Uv Channel Index** - канал UV координати (сітка може мати декілька, але по замовчуванню значення 0, цього вистачає)
- **Mask Threshold 01** - число у діапазоні [0..1], (0 - чорний колір, 1 - білий), є порогом для фільтрації, трава відображатиметься там де колір червоного каналу (R) більше цього значення
- **Draw Gizmo** - вказує чи варто відображати гізмо (лінію) трави (використовується для дебагу в редакторі)
- **Gizmo Radius** - радіус гізмо (довжина лінії трави)

<hr>

#### GrassScriptableObject
- **Id** - унікальний текстовий ідентифікатор трави
- **Mesh** - сітка для єдиного екземпляра трави
